@{
    Layout = "_AdminMenu";
    ViewData["Title"] = "View Flight Routes and Flight Schedules";
}
@model IEnumerable<web2020apr_p01_assignment_group5.Models.ScheduleViewModel>

<link rel="stylesheet" href="~/css/viewschedules.css">
<link rel="stylesheet" href="~/css/switch.css">
<script src="~/js/admin.js" type="text/javascript"></script>

<body>
    <div class="container text-center">

        <div class="row content">
            <h1 class="title">View all Personnels and Flights Assigned</h1>
            <hr />
        </div>

        <div class="row content">
            <input oninput="updateResult(this.value)" class="search__input" type="text" placeholder="Search" />
            <label class="switch ml-auto">
                <input id="toggle_switch" onchange="displayAllTable(this)" type="checkbox">
                <span class="slider round"></span>
            </label>
            <hr />
        </div>

        <div class="result">
            @{int i = 1;}
            @foreach (var item in Model)
            {
                <div id="holder@(i)" class="row content holder">

                    <span class="scheduleid">ScheduleID: @item.ScheduleId</span>
                    <span class="departdate">Departure Date: @item.DepartureDateTime</span>
                    <span class="arrivaldate">Arrival Date: @item.ArrivalDateTime</span>
                    <span onclick="toggle(@(i))" id="arrow@(i)" class="arrow-down"></span>

                </div>

                <div id="flights_table@(i)" class="row content" style="display:none; overflow-x:auto; margin-top:10px;">
                    @if (item.Route != null)
                    {
                        <table>
                            <tr>
                                <th>FlightNumber</th>
                                <th>RouteID</th>
                                <th>DepartureCity</th>
                                <th>DepartureCountry</th>
                                <th>ArrivalCity</th>
                                <th>ArrivalCountry</th>
                                <th>FlightDuration</th>
                                <th>Status</th>
                            </tr>
                            <tr>
                                <td>@item.FlightNumber</td>
                                <td>@item.RouteId</td>
                                <td>@item.Route.DepartureCity</td>
                                <td>@item.Route.DepartureCountry</td>
                                <td>@item.Route.ArrivalCity</td>
                                <td>@item.Route.ArrivalCountry</td>
                                <td>@item.Route.FlightDuration</td>
                                <td>@item.Status</td>
                            </tr>

                        </table>
                    }
                    else
                    {
                        <p>No record found!</p>
                    }
                </div>
                i++;
            }
        </div>
    </div>

    <script type="text/javascript">
        var raw_arr = @Html.Raw(Json.Serialize(Model));

        var arr = [];

        for (i = 0; i < raw_arr.length; i++) {
            arr[i] = raw_arr[i].staffName;
        }

        var _switch = document.getElementById("toggle_switch");

        function displayAllTable(element) {
            var n = arr.length
            if (element.checked) {
                console.log("checked")
                for (i = 1; i < n+1; i++){
                    var tablename = "flights_table" + i;
                    var arrowname = "arrow" + i;
                    var holdername = "holder" + i;

                    var table = document.getElementById(tablename);
                    var arrow = document.getElementById(arrowname);
                    var holder = document.getElementById(holdername);

                    if (holder.style.display != "none") {
                        table.style.display = "";
                        if (arrow != null) {
                            arrow.style["border-bottom"] = "16px solid black";
                            arrow.style["border-top"] = "0px";
                        }

                    }
                }

            } else {
                console.log("unchecked")
                for (i = 1; i < n+1; i++){
                    var tablename = "flights_table" + i;
                    var arrowname = "arrow" + i;
                    var holdername = "holder" + i;

                    var table = document.getElementById(tablename);
                    var arrow = document.getElementById(arrowname);
                    var holder = document.getElementById(holdername);

                    if (holder != null) {
                        table.style.display = "none";
                        if (arrow != null) {
                            arrow.style["border-bottom"] = "0px";
                            arrow.style["border-top"] = "16px solid black";
                        }

                    }
                }
            }
        }

        function updateResult(query) {

            arr.map(function (algo) {
                query.split(" ").map(function (word) {
                    var index = arr.indexOf(algo) + 1;

                    var holdername = "holder" + index;
                    var tablename = "flights_table" + index;
                    var arrowname = "arrow" + i;

                    var holder = document.getElementById(holdername);
                    var table = document.getElementById(tablename);
                    var arrow = document.getElementById(arrowname);

                    if (word == "") {
                        showAll(arr.length)
                    } else if (algo.toLowerCase().indexOf(word.toLowerCase()) != -1) {
                        holder.style.display = "";
                    }else{
                        holder.style.display = "none";
                        if (table != null) {
                            table.style.display = "none";
                            if (arrow != null) {
                                arrow.style["border-bottom"] = "0px";
                                arrow.style["border-top"] = "16px solid black";
                            }

                        }
                    }

                })
            })

            displayAllTable(_switch);
        }

        function showAll(len){
            for (i = 1; i < len+1; i++){
                var holdername = "holder" + i;
                var holder = document.getElementById(holdername);
                holder.style.display = "";
            }
        }

    </script>
</body>
